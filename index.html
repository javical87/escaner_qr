<!DOCTYPE html>
<html>
<head>
    <title>Escáner de Asistentes</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>Escáner de Asistencia</h1>
        <div id="reader"></div>
        <div id="result">
            <p>Escanea un código QR para verificar a un asistente.</p>
        </div>
    </div>

    <script src="https://unpkg.com/html5-qrcode"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const resultDiv = document.getElementById('result');
            let asistentes = {};

            // Cargar la base de datos desde el archivo asistentes.csv
            fetch('asistentes.csv')
                .then(response => response.text())
                .then(data => {
                    const lines = data.split('\n').slice(1); // Ignora la primera fila (encabezado)
                    lines.forEach(line => {
                        const parts = line.split(';');
                        if (parts.length >= 4) {
                            const [id, nombre, cedula] = parts;
                            asistentes[id.trim()] = { nombre: nombre.trim(), cedula: cedula.trim() };
                        }
                    });
                    console.log('Base de datos de asistentes cargada:', asistentes);
                })
                .catch(error => {
                    console.error('Error al cargar la base de datos:', error);
                    resultDiv.innerHTML = '<p class="result-error">Error al cargar la base de datos.</p>';
                });

            // Función que se ejecuta al escanear un código QR
            function onScanSuccess(decodedText) {
                const asistente = asistentes[decodedText.trim()];
                
                if (asistente) {
                    resultDiv.innerHTML = `<p class="result-success">✅ **¡Asistente verificado!**<br>Nombre: ${asistente.nombre}<br>Cédula: ${asistente.cedula}</p>`;
                } else {
                    resultDiv.innerHTML = `<p class="result-error">❌ **No se encontró el asistente.**</p>`;
                }
            }

            // Función para manejar errores de escaneo
            function onScanFailure(error) {
                // No es necesario mostrar errores de forma constante
                // console.warn(`Code scan error = ${error}`);
            }

            const html5QrcodeScanner = new Html5QrcodeScanner(
                "reader", { fps: 10, qrbox: { width: 250, height: 250 } }, false
            );
            html5QrcodeScanner.render(onScanSuccess, onScanFailure);
        });
    </script>
</body>
</html>
