<!DOCTYPE html>
<html>
<head>
    <title>Escáner de Asistentes</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>Escáner de Asistencia</h1>
        <div id="reader"></div>
        <div id="result">
            <p>Escanea un código QR para registrar un asistente.</p>
        </div>
    </div>

    <script src="https://unpkg.com/html5-qrcode"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const resultDiv = document.getElementById('result');
            const appsScriptUrl = 'https://script.google.com/macros/s/AKfycbyEJbhll0Ve0exD0NeeZ3ATzWYXbfN6EMO_HS0xJG0YpKJDijPXRPQCCqK5SY2wI2t3CA/exec'; // Pega la URL que copiaste

            // Función que se ejecuta al escanear un código QR
            async function onScanSuccess(decodedText) {
                resultDiv.innerHTML = `<p>Procesando...</p>`;
                
                try {
                    const response = await fetch(appsScriptUrl, {
                        method: 'POST',
                        body: new URLSearchParams({ id: decodedText.trim() })
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        resultDiv.innerHTML = `<p class="result-success">✅ **¡Asistente registrado!**<br>Nombre: ${data.nombre}<br>Cédula: ${data.cedula}<br>Hora: ${data.hora}</p>`;
                    } else {
                        resultDiv.innerHTML = `<p class="result-error">❌ **${data.message}**</p>`;
                    }
                } catch (error) {
                    resultDiv.innerHTML = `<p class="result-error">Error de conexión con el servidor.</p>`;
                    console.error('Error:', error);
                }
            }

            // Función para manejar errores de escaneo
            function onScanFailure(error) {
                // Se ejecuta si hay un problema al escanear, se puede ignorar para evitar mensajes constantes
            }

            const html5QrcodeScanner = new Html5QrcodeScanner(
                "reader", { fps: 10, qrbox: { width: 250, height: 250 } }, false
            );
            html5QrcodeScanner.render(onScanSuccess, onScanFailure);
        });
    </script>
</body>
</html>

